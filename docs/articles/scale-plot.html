<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scale and Visualize qPCR results • fluidgr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Scale and Visualize qPCR results">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fluidgr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/load-normalize.html">Load and Normalize the qPCR Output</a>
    </li>
    <li>
      <a href="../articles/scale-plot.html">Scale and Visualize qPCR results</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Scale and Visualize qPCR results</h1>
                        <h4 class="author">Otho Mantegazza</h4>
            
            <h4 class="date">2018-11-30</h4>
      
      
      <div class="hidden name"><code>scale-plot.Rmd</code></div>

    </div>

    
    
<p>Here, you will learn how to scale, inspect and visualize the gene expression data that you have parsed in the previous vignette (Load and Normalize the qPCR Output).</p>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(fluidgr)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(stringr)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(forcats)
<span class="kw">library</span>(scales)
<span class="kw">library</span>(devtools)</code></pre></div>
</div>
<div id="data" class="section level1">
<h1 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h1>
<p>We provide the object <code>fluidigm_expr</code>, that stores normalized gene expression measurement.</p>
<p>This object is exaclty the same at the one produced in the vignette (Load and Normalize the qPCR Output).</p>
<p>You can load it with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fluidigm_expr
<span class="co">#&gt; # A tibble: 240 x 7</span>
<span class="co">#&gt;    sample_name sample_type target_name target_type ct_value norm_geom_mean</span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt;  1 J-N2R3      Unknown     gene1       Test            5.79           6.57</span>
<span class="co">#&gt;  2 J-N2R3      Unknown     gene4       Test           15.0            6.57</span>
<span class="co">#&gt;  3 J-N2R3      Unknown     gene2       Test            9.60           6.57</span>
<span class="co">#&gt;  4 J-N2R3      Unknown     gene3       Test            9.52           6.57</span>
<span class="co">#&gt;  5 J-N2R2      Unknown     gene1       Test            5.92           6.46</span>
<span class="co">#&gt;  6 J-N2R2      Unknown     gene4       Test           16.8            6.46</span>
<span class="co">#&gt;  7 J-N2R2      Unknown     gene2       Test            9.27           6.46</span>
<span class="co">#&gt;  8 J-N2R2      Unknown     gene3       Test            8.83           6.46</span>
<span class="co">#&gt;  9 J-N2R1      Unknown     gene1       Test            5.53           5.76</span>
<span class="co">#&gt; 10 J-N2R1      Unknown     gene4       Test           16.4            5.76</span>
<span class="co">#&gt; # ... with 230 more rows, and 1 more variable: expression &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="scale" class="section level1">
<h1 class="hasAnchor">
<a href="#scale" class="anchor"></a>Scale</h1>
<p>Scaling is not necessary, and you can communicate and visualize directly the normalized expression values; stored in the <code>expression</code> column of the <code>fluidigm_expr</code> dataset.</p>
<p>Indeed scaling is not necessary, but, together with exploratory plots, scaling can help you detect patterns in your data. You can understand better the outcome of scaling when you visualize tour data in plots. This is why you can learn about the effects of scaling also in the next section “Visualize”.</p>
<div id="scale-with-the-scale_fluidigm-function" class="section level3">
<h3 class="hasAnchor">
<a href="#scale-with-the-scale_fluidigm-function" class="anchor"></a>Scale with the <code><a href="../reference/scale_fluidigm.html">scale_fluidigm()</a></code> function</h3>
<p>Fluidgr provides the <code><a href="../reference/scale_fluidigm.html">scale_fluidigm()</a></code> function, that scales expression values by z-score according to the groups provided in the argument <code>.group</code>.</p>
<p>This function takes the dataset output of <code><a href="../reference/normalize.html">normalize()</a></code> and returns the same dataset with the extra column <code>scaled_expression</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scaled_dat &lt;-<span class="st"> </span>
<span class="st">  </span>fluidigm_expr <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/scale_fluidigm.html">scale_fluidigm</a></span>(<span class="dt">.group =</span> target_name)</code></pre></div>
</div>
<div id="write-your-own-scaling-function" class="section level3">
<h3 class="hasAnchor">
<a href="#write-your-own-scaling-function" class="anchor"></a>Write your own scaling function</h3>
<p>You can write your own scaling function, becaus <code><a href="../reference/scale_fluidigm.html">scale_fluidigm()</a></code> function is just a soft wrapper around dplyr’s <code><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. If you want to try different scaling methods, you can replicate and tweak the output of <code><a href="../reference/scale_fluidigm.html">scale_fluidigm()</a></code> with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fluidigm_expr <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(target_name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">scaled_expression =</span> <span class="kw">scale</span>(expression))</code></pre></div>
<p>This should provide to you a good basis and enough freedom to explore and visualize your data as you prefer.</p>
</div>
</div>
<div id="visualize" class="section level1">
<h1 class="hasAnchor">
<a href="#visualize" class="anchor"></a>Visualize</h1>
<p>Fluidigmr does not provide plotting function, because all the functions that you need to plot this kind of data are already available in <a href="https://ggplot2.tidyverse.org/">ggplot2</a>. Indeed the dataset output of is already in a <a href="http://r4ds.had.co.nz/tidy-data.html">tidy/gathered format</a>.</p>
<p>Here we provide some ideas of how you can explore, plot and visualize your Fluidigm data.</p>
<div id="what-variables-are-in-your-data" class="section level2">
<h2 class="hasAnchor">
<a href="#what-variables-are-in-your-data" class="anchor"></a>What variables are in your data?</h2>
<p>Make the variables in your data explicit.</p>
<p>Effective visualization depends from the variable that determine the effect in your dataset and eventually by the question that you are trying to anwser.</p>
<p>For example in the sample dataset we are measuring the expression of four genes in 4 developmental stages in 5 species. The column <code>target_name</code> records the “gene” variable, while the other two variables, developmental stage and species, are hidden in the <code>sample_name</code> variable. We can make them explicit.</p>
<p>The <code>sample_name</code> variable is encoded as “J-N1R1”:</p>
<ul>
<li>The first letter “J” is the species.</li>
<li>The letter and the number after the hyphen “N1” encode for the stage.</li>
<li>The last letter and number “R1” encode for the replicate.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fluidigm_expr &lt;-<span class="st"> </span>
<span class="st">  </span>fluidigm_expr <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># make species explicit</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">species =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/stringr/topics/str_split">str_split_fixed</a></span>(<span class="dt">string =</span> sample_name,
                                   <span class="dt">pattern =</span> <span class="st">"-"</span>,
                                   <span class="dt">n =</span> <span class="dv">2</span>)[, <span class="dv">1</span>]) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># make stage explicit</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">stage =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/stringr/topics/str_sub">str_sub</a></span>(<span class="dt">string =</span> sample_name,
                         <span class="dt">start =</span> <span class="dv">3</span>,
                         <span class="dt">end =</span> <span class="dv">4</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># make replicate explicit</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">replicate =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/stringr/topics/str_sub">str_sub</a></span>(<span class="dt">string =</span> sample_name,
                         <span class="dt">start =</span> <span class="dv">5</span>,
                         <span class="dt">end =</span> <span class="dv">6</span>))</code></pre></div>
</div>
<div id="lineplot" class="section level2">
<h2 class="hasAnchor">
<a href="#lineplot" class="anchor"></a>Lineplot</h2>
<p>A lineplot can be informative directly on normalized data, without scaling.</p>
<p>You can use facets to display multivariate data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span>fluidigm_expr <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> stage,
             <span class="dt">y =</span> expression)) <span class="op">+</span>
<span class="st">  </span><span class="co"># plot each expression value into a point</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="dt">size =</span> <span class="dv">2</span>,
               <span class="dt">col =</span> <span class="st">"#DA614D"</span>,
               <span class="dt">alpha =</span> .<span class="dv">8</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># it might be complicated to add a line that connect means</span>
<span class="st">  </span><span class="co"># across stages,</span>
<span class="st">  </span><span class="co"># because stages are encoded as a categorical variable,</span>
<span class="st">  </span><span class="co"># we must turn them into numeric</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> stage <span class="op">%&gt;%</span>
<span class="st">                     </span><span class="kw">as.factor</span>(.) <span class="op">%&gt;%</span>
<span class="st">                     </span><span class="kw">as.numeric</span>(.)),
               <span class="dt">fun.y =</span> mean,
               <span class="dt">geom=</span><span class="st">"line"</span>,
               <span class="dt">size =</span> <span class="fl">1.2</span>,
               <span class="dt">alpha =</span> .<span class="dv">7</span>,
               <span class="dt">linejoin =</span> <span class="st">"round"</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># implement facetting with independent y values</span>
<span class="st">  </span><span class="co"># for each genes, since expression values are</span>
<span class="st">  </span><span class="co"># not comparable across genes</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(target_name <span class="op">~</span><span class="st"> </span>species,
               <span class="dt">scales =</span> <span class="st">"free_y"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() 

p <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</code></pre></div>
<p><img src="scale-plot_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Some patterns in your data might be more evident if you plot them in log scale.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_log &lt;-<span class="st"> </span>
<span class="st">  </span>p <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span>()

p_log <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</code></pre></div>
<p><img src="scale-plot_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Also using heatmap with ggplot2</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_heat &lt;-<span class="st"> </span>
<span class="st">  </span>fluidigm_expr <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> stage,
             <span class="dt">y =</span> target_name,
             <span class="dt">fill =</span> expression)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(. <span class="op">~</span><span class="st"> </span>species) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span>()

p_heat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</code></pre></div>
<p><img src="scale-plot_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Sometime heatmap don’t convey muich invormation if you don’t scale your data.</p>
<p>For example we can scale every gene on z-score to make them comparable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scaled_gene &lt;-<span class="st"> </span>
<span class="st">  </span>fluidigm_expr <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(target_name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">scaled_expression =</span> expression <span class="op">%&gt;%</span>
<span class="st">           </span><span class="kw"><a href="http://www.rdocumentation.org/packages/scales/topics/rescale">rescale</a></span>(<span class="dt">from =</span> <span class="kw">range</span>(.), <span class="dt">to =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</code></pre></div>
<p>Check if the heatmap has improved</p>
<p><strong>remeber to map the colours to the new <code>scaled_expression</code> values</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_heat &lt;-<span class="st"> </span>
<span class="st">  </span>scaled_gene <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> stage,
             <span class="dt">y =</span> species,
             <span class="dt">fill =</span> scaled_expression)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(. <span class="op">~</span><span class="st"> </span>target_name) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span>()

p_heat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</code></pre></div>
<p><img src="scale-plot_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>We can try to set more groups.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scaled_dat &lt;-<span class="st"> </span>
<span class="st">  </span>fluidigm_expr <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(target_name, species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">scaled_expression =</span> expression <span class="op">%&gt;%</span>
<span class="st">           </span><span class="kw"><a href="http://www.rdocumentation.org/packages/scales/topics/rescale">rescale</a></span>(<span class="dt">from =</span> <span class="kw">range</span>(.), <span class="dt">to =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</code></pre></div>
<p>Check if the heatmap has improved</p>
<p><strong>remeber to map the colours to the new <code>scaled_expression</code> values</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_heat &lt;-<span class="st"> </span>
<span class="st">  </span>scaled_dat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> stage,
             <span class="dt">y =</span> species,
             <span class="dt">fill =</span> scaled_expression)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(. <span class="op">~</span><span class="st"> </span>target_name) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span>()

p_heat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</code></pre></div>
<p><img src="scale-plot_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
</div>
<div id="scale-and-center-on-a-specific-group---timecourses" class="section level1">
<h1 class="hasAnchor">
<a href="#scale-and-center-on-a-specific-group---timecourses" class="anchor"></a>Scale and center on a specific group - Timecourses</h1>
<p>Sometime it might be useful to center the expression data on a specific timepoint or condition, in a manner similar to the <span class="math inline">\(2^{ - \Delta \Delta Ct}\)</span> method</p>
<p>This can be achieved with the function <code>center_stage()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">center_stage &lt;-<span class="st"> </span><span class="cf">function</span>(scaled_data, group_var, group_var2, center_var)
  { 
  <span class="kw">stopifnot</span>(<span class="st">"scaled_expression"</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(scaled_data))
  group_var &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/tidyeval.html">enquo</a></span>(group_var)
  group_var2 &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/tidyeval.html">enquo</a></span>(group_var2)
    scaled_data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="op">!!</span>group_var, <span class="op">!!</span>group_var2) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">center_mean =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(stage <span class="op">==</span><span class="st"> </span>center_var <span class="op">~</span><span class="st"> </span>scaled_expression) <span class="op">%&gt;%</span>
<span class="st">               </span><span class="kw">mean</span>(<span class="dt">na.rm =</span> T),
             <span class="dt">centered_exp =</span> scaled_expression<span class="op">/</span>center_mean) 
}

centered_dat &lt;-<span class="st"> </span>
<span class="st">  </span>scaled_dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">center_stage</span>(<span class="dt">group_var =</span> species,
               <span class="dt">group_var2 =</span> target_name,
               <span class="dt">center_var =</span> <span class="st">"N1"</span>)

centered_dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> stage,
             <span class="dt">y =</span> centered_exp,
             <span class="dt">group =</span> species,
             <span class="dt">colour =</span> species)) <span class="op">+</span>
<span class="st">  </span><span class="co"># plot each expression value into a point</span>
<span class="st">  </span><span class="co"># geom_point(size = 2,</span>
<span class="st">  </span><span class="co">#              col = "#DA614D",</span>
<span class="st">  </span><span class="co">#              alpha = .8) +</span>
<span class="st">  </span><span class="co"># it might be complicated to add a line that connect means</span>
<span class="st">  </span><span class="co"># across stages,</span>
<span class="st">  </span><span class="co"># because stages are encoded as a categorical variable,</span>
<span class="st">  </span><span class="co"># we must turn them into numeric</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> stage <span class="op">%&gt;%</span>
<span class="st">                     </span><span class="kw">as.factor</span>(.) <span class="op">%&gt;%</span>
<span class="st">                     </span><span class="kw">as.numeric</span>(.)),
               <span class="dt">fun.y =</span> mean,
               <span class="dt">geom=</span><span class="st">"line"</span>,
               <span class="dt">size =</span> <span class="fl">1.2</span>,
               <span class="dt">alpha =</span> .<span class="dv">7</span>,
               <span class="dt">linejoin =</span> <span class="st">"round"</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># implement facetting with independent y values</span>
<span class="st">  </span><span class="co"># for each genes, since expression values are</span>
<span class="st">  </span><span class="co"># not comparable across genes</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="dt">facet =</span> <span class="st">"target_name"</span>,
             <span class="dt">scales =</span> <span class="st">"free"</span>,
             <span class="dt">nrow =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() </code></pre></div>
<p><img src="scale-plot_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setup">Setup</a></li>
      <li><a href="#data">Data</a></li>
      <li><a href="#scale">Scale</a></li>
      <li>
<a href="#visualize">Visualize</a><ul class="nav nav-pills nav-stacked">
<li><a href="#what-variables-are-in-your-data">What variables are in your data?</a></li>
      <li><a href="#lineplot">Lineplot</a></li>
      </ul>
</li>
      <li><a href="#scale-and-center-on-a-specific-group---timecourses">Scale and center on a specific group - Timecourses</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Otho Mantegazza.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
