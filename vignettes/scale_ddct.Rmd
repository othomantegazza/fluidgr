---
title: "Delta Delta Ct, Center on One Experimental Condition"
author: "Otho Mantegazza"
date: "`r Sys.Date()`"
output:
  knitr:::html_vignette:
    toc: yes
    number_sections: true
    highlight: default
vignette: >
  %\VignetteIndexEntry{Delta Delta Ct, Center on One Experimental Condition}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


Here, you will learn how to scale, inspect and visualize the gene expression data by centering the mesurement on one single experimental condition (in what is known as the $2^{ - \Delta \Delta Ct}$ method).

This method is uesful when you want to take one experimental condition as reference. For example, the start time when analyzing time series.

# Setup

```{r packages, message = FALSE}
library(fluidgr)
library(magrittr)
library(dplyr)
library(stringr)
library(ggplot2)
library(forcats)
library(scales)
library(devtools)
```

# Data

We use the `scaled_fluidigm` dataset to illustrate how to apply the $2^{ - \Delta \Delta Ct}$ method.

```{r}
data(scaled_fluidigm)
```

# How to use the function `scale_ddct()`

```{r}
ddct_flluidigm <- 
  scaled_fluidigm %>% 
  scale_ddct(
    # group_var = species,
    # group_var2 = target_name,
    species, target_name,
    compare_var = stage,
    center_on = "N1"
  )

ddct_flluidigm %>% 
    ggplot(aes(x = stage,
               y = ddct_exp,
               group = species,
               colour = species)) +
  # plot each expression value into a point
  # geom_point(size = 2,
  #              col = "#DA614D",
  #              alpha = .8) +
  # it might be complicated to add a line that connect means
  # across stages,
  # because stages are encoded as a categorical variable,
  # we must turn them into numeric
  stat_summary(aes(x = stage %>%
                     as.factor(.) %>%
                     as.numeric(.)),
               fun.y = mean,
               geom="line",
               size = 1.2,
               alpha = .7,
               linejoin = "round") +
  # implement facetting with independent y values
  # for each genes, since expression values are
  # not comparable across genes
  facet_wrap(facet = "target_name",
             scales = "free",
             nrow = 1) +
  theme_bw() 
```

